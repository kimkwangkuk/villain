(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[540],{5273:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>A});var a=r(5155),s=r(2115),l=r(5695),n=r(6874),d=r.n(n),o=r(1559),i=r(832),c=r.n(i),u=r(9670),x=r(5317);let m=async(e,t)=>{try{let r=(0,x.H9)(u.db,"comments",e),a=await (0,x.x7)(r);if(!a.exists())throw Error("댓글이 존재하지 않습니다.");(a.data().likedBy||[]).includes(t)?await (0,x.mZ)(r,{likes:(0,x.GV)(-1),likedBy:(0,x.C3)(t),updatedAt:(0,x.O5)()}):await (0,x.mZ)(r,{likes:(0,x.GV)(1),likedBy:(0,x.hq)(t),updatedAt:(0,x.O5)()});let s=await (0,x.x7)(r);return{id:e,...s.data()}}catch(e){throw console.error("댓글 좋아요 업데이트 실패:",e),e}},h=async(e,t,r)=>{try{let a=u.j2.currentUser;if(!a)throw Error("로그인이 필요합니다");let s=(0,x.H9)(u.db,"comments",t);if(!(await (0,x.x7)(s)).exists())throw Error("댓글이 존재하지 않습니다");let l=(0,x.H9)(u.db,"users",a.uid),n=await (0,x.x7)(l),d=n.exists()?n.data():null,o=(0,x.rJ)(s,"replies"),i={content:r,authorId:a.uid,authorName:(null==d?void 0:d.username)||a.displayName||a.email||"익명",authorPhotoURL:(null==d?void 0:d.photoURL)||a.photoURL||null,createdAt:(0,x.O5)(),postId:e};return{id:(await (0,x.gS)(o,i)).id,...i}}catch(e){throw console.error("대댓글 작성 실패:",e),e}},p=async e=>{try{let t=(0,x.H9)(u.db,"comments",e);return(await (0,x.GG)((0,x.rJ)(t,"replies"))).docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("대댓글 가져오기 실패:",e),[]}},g=async(e,t)=>{try{let r=u.j2.currentUser;if(!r)throw Error("로그인이 필요합니다");let a=(0,x.H9)(u.db,"comments",t),s=await (0,x.x7)(a);if(!s.exists())throw Error("댓글이 존재하지 않습니다");if(s.data().authorId!==r.uid)throw Error("자신의 댓글만 삭제할 수 있습니다");let l=(await (0,x.GG)((0,x.rJ)(a,"replies"))).docs.map(e=>(0,x.kd)((0,x.H9)(a,"replies",e.id)));await Promise.all(l),await (0,x.kd)(a);let n=(0,x.H9)(u.db,"posts",e);await (0,x.mZ)(n,{commentCount:(0,x.GV)(-1)})}catch(e){throw console.error("댓글 삭제 실패:",e),e}},f=async(e,t,r)=>{try{let e=u.j2.currentUser;if(!e)throw Error("로그인이 필요합니다");let a=(0,x.H9)(u.db,"comments",t),s=(0,x.H9)((0,x.rJ)(a,"replies"),r),l=await (0,x.x7)(s);if(!l.exists())throw Error("대댓글이 존재하지 않습니다");if(l.data().authorId!==e.uid)throw Error("자신의 대댓글만 삭제할 수 있습니다");await (0,x.kd)(s)}catch(e){throw console.error("대댓글 삭제 실패:",e),e}};var v=r(7242),b=r(1694),j=r(1175);let N=function(e){var t,r;let{comment:l,postAuthorId:n,onEdit:d,onDelete:i}=e,{user:u}=(0,o.A)(),[x,g]=(0,s.useState)(!1),[N,y]=(0,s.useState)(!1),[k,w]=(0,s.useState)(!1),[C,I]=(0,s.useState)(l.content),[E,S]=(0,s.useState)(l.likes||0),[L,R]=(0,s.useState)(!!u&&!!l.likedBy&&l.likedBy.includes(u.uid)),[U,D]=(0,s.useState)(!1),P=(0,s.useRef)(null),[A,H]=(0,s.useState)(!1),[z,_]=(0,s.useState)([]),[B,O]=(0,s.useState)(!1),[Y,Z]=(0,s.useState)(null),q=(0,s.useRef)(null);(0,s.useEffect)(()=>{let e=e=>{P.current&&!P.current.contains(e.target)&&g(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{let e=e=>{q.current&&!q.current.contains(e.target)&&Z(null)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let F=e=>e?e.toDate?c()(e.toDate()).format("YYYY.MM.DD"):c()(e).format("YYYY.MM.DD"):"",G=async()=>{if(!(null==u?void 0:u.uid))return void alert("로그인이 필요합니다.");if(!U){R(!L),S(L?E-1:E+1);try{var e,t;D(!0);let r=await m(l.id,u.uid);S(null!=(e=r.likes)?e:0),R((null!=(t=r.likedBy)?t:[]).includes(u.uid))}catch(e){R(L),S(E),console.error("댓글 좋아요 업데이트 실패:",e),alert("좋아요 처리에 실패했습니다.")}finally{D(!1)}}};(0,s.useEffect)(()=>{(async()=>{try{let e=await p(l.id);_(e)}catch(e){console.error("대댓글 로딩 실패:",e)}})()},[l.id]);let M=async e=>{if(!e.trim())return!1;try{let t=await h(l.postId,l.id,e);return t&&(_(e=>[...e,t]),H(!1),O(!0)),!0}catch(e){return console.error("대댓글 작성 실패:",e),alert("대댓글 작성에 실패했습니다."),!1}},J=async e=>{try{_(t=>t.filter(t=>t.id!==e)),await f(l.postId,l.id,e)}catch(r){let t=z.find(t=>t.id===e);t&&_(e=>[...e,t]),console.error("대댓글 삭제 실패:",r),alert("대댓글 삭제에 실패했습니다.")}},$=async()=>{try{i&&i()}catch(e){console.error("댓글 삭제 실패:",e),alert("댓글 삭제에 실패했습니다.")}},T=async()=>{if(!u)return void alert("로그인이 필요합니다.");try{if(await (0,v.qH)("comment",l.id,u.uid))return void alert("이미 신고한 댓글입니다.");await (0,v.wD)("comment",l.id,u.uid,"부적절한 내용"),alert("신고가 접수되었습니다.")}catch(e){console.error("댓글 신고 실패:",e),alert("신고 처리에 실패했습니다.")}},V=async e=>{if(!u)return void alert("로그인이 필요합니다.");try{if(await (0,v.qH)("reply",e,u.uid))return void alert("이미 신고한 댓글입니다.");await (0,v.wD)("reply",e,u.uid,"부적절한 내용"),alert("신고가 접수되었습니다.")}catch(e){console.error("대댓글 신고 실패:",e),alert("신고 처리에 실패했습니다.")}};return(0,a.jsxs)("div",{className:"mb-4 last:mb-0",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-2 bg-gray-200 dark:bg-neutral-700 flex items-center justify-center",children:l.authorPhotoURL&&!N?(0,a.jsx)("img",{src:l.authorPhotoURL,alt:"".concat(l.authorName,"의 프로필"),className:"w-full h-full object-cover",onError:()=>y(!0)}):(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:(null==(r=l.authorName)||null==(t=r.charAt(0))?void 0:t.toUpperCase())||"?"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"font-medium text-sm text-gray-900 dark:text-neutral-200",children:l.authorName||"익명"}),l.authorId===n&&(0,a.jsx)("span",{className:"ml-1 px-1 py-0.5 text-[10px] bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded",children:"작성자"})]}),(0,a.jsx)("span",{className:"text-xs text-gray-500 dark:text-neutral-500",children:F(l.createdAt)})]})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>g(!x),className:"p-1 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-full",children:(0,a.jsx)(b.z_,{className:"w-4 h-4 text-gray-500 dark:text-neutral-500"})}),x&&(0,a.jsxs)("div",{ref:P,className:"absolute right-0 top-full mt-1 bg-white dark:bg-neutral-800 rounded-md shadow-lg z-10 w-32 py-1",children:[u&&l.authorId===u.uid&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>{w(!0),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-700",children:"수정"}),(0,a.jsx)("button",{onClick:()=>{$(),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-neutral-700",children:"삭제"})]}),(!u||l.authorId!==u.uid)&&(0,a.jsx)("button",{onClick:()=>{T(),g(!1)},className:"w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-700",children:"신고"})]})]})]}),(0,a.jsxs)("div",{className:"mt-1 pl-10",children:[k?(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("textarea",{value:C,onChange:e=>I(e.target.value),className:"w-full p-2 border border-gray-300 dark:border-neutral-700 rounded-md bg-white dark:bg-neutral-800 text-gray-800 dark:text-neutral-200 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3}),(0,a.jsxs)("div",{className:"flex justify-end mt-2 space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{w(!1),I(l.content)},className:"px-3 py-1 text-sm text-gray-600 dark:text-neutral-400 hover:text-gray-800 dark:hover:text-neutral-200",children:"취소"}),(0,a.jsx)("button",{onClick:()=>{C.trim()&&C!==l.content&&d(C),w(!1)},className:"px-3 py-1 text-sm bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"수정 완료"})]})]}):(0,a.jsx)("p",{className:"text-gray-800 dark:text-neutral-300 whitespace-pre-wrap break-words",children:l.content}),(0,a.jsxs)("div",{className:"flex items-center mt-2 space-x-4",children:[(0,a.jsxs)("button",{onClick:G,className:"flex items-center text-xs ".concat(L?"text-blue-600 dark:text-blue-400":"text-gray-500 dark:text-neutral-500"," hover:text-blue-600 dark:hover:text-blue-400"),disabled:U,children:[(0,a.jsx)(b.px,{className:"w-4 h-4 mr-1 ".concat(L?"fill-blue-600 dark:fill-blue-400":"fill-none")}),(0,a.jsx)("span",{children:E>0?E:"좋아요"})]}),(0,a.jsxs)("button",{onClick:()=>{if(!u)return void alert("로그인이 필요합니다.");H(!0)},className:"flex items-center text-xs text-gray-500 dark:text-neutral-500 hover:text-gray-700 dark:hover:text-neutral-300",children:[(0,a.jsx)(b.b1,{className:"w-4 h-4 mr-1"}),(0,a.jsx)("span",{children:"답글"})]}),z.length>0&&(0,a.jsx)("button",{onClick:()=>O(!B),className:"text-xs text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300",children:B?"답글 숨기기":"답글 ".concat(z.length,"개 보기")})]}),B&&z.length>0&&(0,a.jsx)("div",{className:"mt-3 space-y-3",children:z.map(e=>{var t,r;return(0,a.jsxs)("div",{className:"flex items-start",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full overflow-hidden mr-2 bg-gray-200 dark:bg-neutral-700 flex items-center justify-center flex-shrink-0",children:e.authorPhotoURL?(0,a.jsx)("img",{src:e.authorPhotoURL,alt:"".concat(e.authorName,"의 프로필"),className:"w-full h-full object-cover",onError:t=>{let r=t.target;r.style.display="none";let a=r.parentNode;if(a){var s,l;let t=document.createElement("span");t.className="text-xs text-gray-600 dark:text-gray-400",t.textContent=(null==(l=e.authorName)||null==(s=l.charAt(0))?void 0:s.toUpperCase())||"?",a.appendChild(t)}}}):(0,a.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:(null==(r=e.authorName)||null==(t=r.charAt(0))?void 0:t.toUpperCase())||"?"})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"font-medium text-xs text-gray-900 dark:text-neutral-200",children:e.authorName||"익명"}),e.authorId===n&&(0,a.jsx)("span",{className:"ml-1 px-1 py-0.5 text-[8px] bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded",children:"작성자"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-800 dark:text-neutral-300 mt-0.5 whitespace-pre-wrap break-words",children:e.content}),(0,a.jsx)("span",{className:"text-[10px] text-gray-500 dark:text-neutral-500 mt-0.5 block",children:F(e.createdAt)})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>Z(Y===e.id?null:e.id),className:"p-1 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded-full",children:(0,a.jsx)(b.z_,{className:"w-3 h-3 text-gray-500 dark:text-neutral-500"})}),Y===e.id&&(0,a.jsxs)("div",{ref:q,className:"absolute right-0 top-full mt-1 bg-white dark:bg-neutral-800 rounded-md shadow-lg z-10 w-24 py-1",children:[u&&e.authorId===u.uid&&(0,a.jsx)("button",{onClick:()=>{J(e.id),Z(null)},className:"w-full text-left px-3 py-1 text-xs text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-neutral-700",children:"삭제"}),(!u||e.authorId!==u.uid)&&(0,a.jsx)("button",{onClick:()=>{V(e.id),Z(null)},className:"w-full text-left px-3 py-1 text-xs text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-700",children:"신고"})]})]})]})})]},e.id)})})]})]}),A&&(0,a.jsx)(j.eI,{isOpen:A,onClose:()=>H(!1),onSubmit:M,commentAuthor:l.authorName||"익명"})]})};var y=r(8402),k=r(2723);let w=function(){return(0,a.jsxs)("div",{className:"bg-white dark:bg-black min-h-screen pb-8",children:[(0,a.jsx)("div",{className:"w-full px-4",children:(0,a.jsxs)("div",{className:"max-w-[590px] mx-auto bg-gray-100 dark:bg-[#121212] rounded-2xl",children:[(0,a.jsx)("div",{className:"pb-[0px] p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-300 dark:bg-neutral-800 dark-pulse"}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("div",{className:"h-[13px] w-24 bg-gray-300 dark:bg-neutral-800 rounded mb-1 dark-pulse"}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"h-[12px] w-16 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"mx-1 h-[12px] text-gray-500 dark:text-neutral-500",children:"\xb7"}),(0,a.jsx)("div",{className:"h-[12px] w-20 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]})]})]}),(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-300 dark:bg-neutral-800 dark-pulse"})]})}),(0,a.jsxs)("div",{className:"pt-[0px] p-4 pb-0",children:[(0,a.jsxs)("div",{className:"pt-3 pb-6",children:[(0,a.jsx)("div",{className:"h-[20px] w-3/4 bg-gray-300 dark:bg-neutral-800 rounded mb-2 dark-pulse"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"h-[16px] w-full bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[16px] w-full bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[16px] w-3/4 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[16px] w-1/2 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-[14px] text-gray-500 dark:text-neutral-500 pb-3",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex -space-x-1 mr-1",children:(0,a.jsx)("div",{className:"w-5 h-5 bg-gray-300 dark:bg-neutral-800 rounded-full dark-pulse"})}),(0,a.jsx)("div",{className:"h-[14px] w-20 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]}),(0,a.jsx)("div",{className:"h-[14px] w-16 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 dark:border-neutral-900 py-2 -mx-4 px-4",children:[(0,a.jsx)("div",{className:"h-[36px] w-[80px] bg-gray-300 dark:bg-neutral-800 rounded-full dark-pulse"}),(0,a.jsx)("div",{className:"absolute left-1/2 transform -translate-x-1/2",children:(0,a.jsx)("div",{className:"h-[36px] w-[80px] bg-gray-300 dark:bg-neutral-800 rounded-full dark-pulse"})}),(0,a.jsx)("div",{className:"h-[36px] w-[80px] bg-gray-300 dark:bg-neutral-800 rounded-full dark-pulse"})]})]})]})}),(0,a.jsx)("div",{className:"w-full px-4 mt-4",children:(0,a.jsxs)("div",{className:"max-w-[590px] mx-auto",children:[(0,a.jsx)("div",{className:"bg-gray-100 dark:bg-[#121212] rounded-2xl",children:(0,a.jsx)("div",{className:"bg-gray-100 dark:bg-[#121212] rounded-2xl p-[12px] w-full",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-[30px] h-[30px] rounded-full bg-gray-300 dark:bg-neutral-800 flex-shrink-0 dark-pulse"}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,a.jsx)("div",{className:"flex-1 h-[24px] bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"flex-shrink-0 w-[60px] h-[32px] bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]})})]})})}),(0,a.jsx)("div",{className:"mt-4 bg-gray-100 dark:bg-[#121212] rounded-2xl",children:[1,2,3].map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"py-[16px]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start px-[20px]",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-[6px]",children:[(0,a.jsx)("div",{className:"w-[20px] h-[20px] rounded-full bg-gray-300 dark:bg-neutral-800 dark-pulse"}),(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-[13px] w-24 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[13px] w-24 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]})})]}),(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-300 dark:bg-neutral-800 dark-pulse"})]}),(0,a.jsxs)("div",{className:"mt-1 px-[20px]",children:[(0,a.jsx)("div",{className:"h-[15px] w-full bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[15px] w-3/4 mt-1 bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]}),(0,a.jsxs)("div",{className:"mt-2 flex items-center space-x-4 px-[20px]",children:[(0,a.jsx)("div",{className:"h-[18px] w-[60px] bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"}),(0,a.jsx)("div",{className:"h-[18px] w-[60px] bg-gray-300 dark:bg-neutral-800 rounded dark-pulse"})]})]}),2!==t&&(0,a.jsx)("div",{className:"h-[1px] bg-gray-200 dark:bg-neutral-800"})]},t))})]})}),(0,a.jsx)("style",{children:"\n          @keyframes darkPulse {\n            0%, 100% {\n              opacity: 1;\n            }\n            50% {\n              opacity: 0.6;\n            }\n          }\n          \n          .dark-pulse {\n            animation: darkPulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n          }\n          \n          @media (prefers-color-scheme: dark) {\n            .animate-pulse {\n              animation: none;\n            }\n          }\n          \n          :root.dark .animate-pulse {\n            animation: none;\n          }\n        "})]})};r(9810);var C=r(9758),I=r.n(C);let E=e=>{try{let t=new URL(e),r=t.pathname+t.search,a=r.length>20?r.substring(0,20)+"...":r;return"".concat(t.hostname).concat(a)}catch(t){return e}},S=e=>{let t=/(https?:\/\/[^\s]+)/g;return e.split(t).map((e,r)=>e.match(t)?{type:"url",content:e,display:E(e),key:r}:{type:"text",content:e,key:r})};var L=r(8038),R=r(285),U=r(6695),D=r(1394),P=r(4838);c().locale("ko"),c().extend(I());let A=function(){var e,t;let r,n=(0,l.useParams)();console.log("useParams() 값:",n);let i=(null==n?void 0:n.postId)||"";console.log("추출된 ID:",i);let m=(0,l.useRouter)(),h=(0,l.usePathname)(),[p,f]=(0,s.useState)(null),[v,j]=(0,s.useState)([]),[C,I]=(0,s.useState)(""),{user:E,isLoggedIn:A}=(0,o.A)(),[H,z]=(0,s.useState)(!0),[_,B]=(0,s.useState)(null),[O,Y]=(0,s.useState)(!1),[Z,q]=(0,s.useState)(!1),[F,G]=(0,s.useState)(!1),[M,J]=(0,s.useState)(!1),$=(0,s.useRef)(null),[T,V]=(0,s.useState)(!1),K=(0,s.useRef)(null),[Q,W]=(0,s.useState)(null),[X,ee]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e=e=>{e.target.closest("button")||($.current&&!$.current.contains(e.target)&&J(!1),K.current&&!K.current.contains(e.target)&&V(!1))};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,s.useEffect)(()=>{window.scrollTo(0,0)},[]),(0,s.useEffect)(()=>{z(!0),f(null),j([]),B(null);let e=null==n?void 0:n.postId;if(console.log("페이지 초기화, postId:",e),!e){console.log("ID가 없어서 데이터를 로드하지 않습니다."),z(!1),B("잘못된 게시물 ID입니다.");return}console.log("포스트 데이터 로드 시작:",e);let t=async()=>{try{let t=(0,x.H9)(u.db,"posts",e),r=await (0,x.x7)(t);if(r.exists()){let e={id:r.id,...r.data()};console.log("포스트 데이터 로드 완료:",e),f(e),await (0,x.mZ)(t,{viewCount:(e.viewCount||0)+1}),E&&e.likedBy&&Y(e.likedBy.includes(E.uid))}else console.log("포스트가 존재하지 않습니다."),B("포스트를 찾을 수 없습니다.")}catch(e){console.error("포스트를 불러오는데 실패했습니다:",e),B(e.message||"게시물을 불러오는데 실패했습니다.")}finally{console.log("로딩 상태를 false로 변경합니다."),z(!1)}};console.log("댓글 쿼리 생성:",e);let r=(0,x.P)((0,x.rJ)(u.db,"comments"),(0,x._M)("postId","==",e),(0,x.My)("createdAt","desc")),a=(0,x.aQ)(r,e=>{let t=e.docs.map(e=>{var t;return{id:e.id,...e.data(),createdAt:null==(t=e.data().createdAt)?void 0:t.toDate()}});console.log("댓글 데이터 로드 완료:",t.length),j(t)},e=>{console.error("댓글 구독 에러:",e),B(e.message||"댓글을 불러오는데 실패했습니다.")});return t(),()=>{console.log("컴포넌트 언마운트, 구독 취소"),a()}},[null==n?void 0:n.postId]),(0,s.useEffect)(()=>{let e=null==n?void 0:n.postId;e&&(async()=>{try{let t=await (0,k.l)(e);E&&t[E.uid]&&W(t[E.uid]);let r={};Object.values(t).forEach(e=>{e&&e.emoji&&(r[e.emoji]||(r[e.emoji]=0),r[e.emoji]++)});let a=Object.keys(r).sort((e,t)=>r[t]-r[e]).slice(0,3);ee(a)}catch(e){console.error("반응 데이터 로드 실패:",e)}})()},[null==n?void 0:n.postId,E]);let et=async e=>{e.preventDefault();let t=null==n?void 0:n.postId;if(!(null==E?void 0:E.uid)||!t)return void alert("로그인이 필요합니다.");if(!C.trim())return;I("");let r=e.target.querySelector("textarea");r&&(r.style.height="auto",r.style.height="24px");let a=(null==p?void 0:p.commentCount)||0;f(e=>({...e,commentCount:a+1}));try{await (0,x.gS)((0,x.rJ)(u.db,"comments"),{postId:t,content:C,authorId:E.uid,authorName:E.displayName,authorPhotoURL:E.photoURL,createdAt:(0,x.O5)()})}catch(e){f(e=>({...e,commentCount:a})),I(C),console.error("댓글 작성 실패:",e),alert("댓글 작성에 실패했습니다.")}},er=async()=>{try{await navigator.clipboard.writeText(window.location.href),q(!0),setTimeout(()=>q(!1),2e3)}catch(e){console.error("클립보드 복사 실패:",e)}},ea=async(e,t)=>{if(t.trim())try{await (0,x.mZ)((0,x.H9)(u.db,"comments",e),{content:t,updatedAt:(0,x.O5)()})}catch(e){console.error("댓글 수정 실패:",e),alert("댓글 수정에 실패했습니다.")}},es=async e=>{let t=null==n?void 0:n.postId;if(t)try{await g(t,e)}catch(e){console.error("댓글 삭제 실패:",e),alert("댓글 삭제에 실패했습니다.")}},el=async()=>{let e=null==n?void 0:n.postId;if(e)try{await (0,y.ys)(e),m.push("/")}catch(e){console.error("게시글 삭제 실패:",e),alert("게시글 삭제에 실패했습니다.")}},en=async e=>{e.preventDefault(),e.stopPropagation();let t=null==n?void 0:n.postId;if(!A||!E||!t)return void alert("로그인이 필요합니다.");if(T)return void V(!1);if(Q){try{W(null);let e=await (0,k.t)(t,E.uid,null);f(t=>({...t,reactionCount:e.reactionCount}))}catch(e){console.error("반응 취소 실패:",e),alert("반응 취소에 실패했습니다.")}return}V(!0)},ed=async e=>{let t=null==n?void 0:n.postId;if(t&&E)try{if((null==Q?void 0:Q.id)===e.id){W(null),V(!1);let e=await (0,k.t)(t,E.uid,null);f(t=>t?{...t,reactionCount:e.reactionCount}:null);return}W(e),V(!1);let r=await (0,k.t)(t,E.uid,e);if(f(e=>e?{...e,reactionCount:r.reactionCount}:null),!r)throw W(Q),Error("반응 업데이트 실패")}catch(e){console.error("반응 처리 실패:",e),alert("반응 처리에 실패했습니다.")}},eo=(e,t)=>{e.preventDefault(),e.stopPropagation(),m.push("/?category=".concat(t))};return H?(console.log("로딩 중... 스켈레톤 표시"),(0,a.jsx)(w,{})):_?(console.log("에러 발생:",_),(0,a.jsx)("div",{className:"text-center py-8 text-red-500 dark:text-red-400",children:_})):p?(0,a.jsxs)("div",{className:"bg-background min-h-screen pb-8",children:[(0,a.jsx)("div",{className:"w-full px-4",children:(0,a.jsx)("div",{className:"max-w-[590px] mx-auto",children:(0,a.jsxs)(U.Zp,{className:"bg-card shadow-sm rounded-xl overflow-hidden p-5 pb-3",children:[(0,a.jsx)(U.aR,{className:"space-y-0 p-0",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)(D.eu,{className:"h-8 w-8",children:[(0,a.jsx)(D.BK,{src:(null==p?void 0:p.authorPhotoURL)||"https://api.dicebear.com/9.x/notionists-neutral/svg?seed=".concat(null==p?void 0:p.authorId,"&backgroundColor=e8f5e9"),alt:"".concat(null==p?void 0:p.authorName,"의 프로필")}),(0,a.jsx)(D.q5,{className:"bg-muted",children:null==p||null==(e=p.authorName)?void 0:e.charAt(0)})]}),(0,a.jsxs)("div",{className:"ml-2",children:[(0,a.jsx)("div",{className:"text-[13px] font-semibold text-foreground",children:null==p?void 0:p.authorName}),(0,a.jsxs)("div",{className:"text-[12px] text-muted-foreground",children:[(0,a.jsx)("button",{onClick:e=>eo(e,null==p?void 0:p.categoryId),className:"hover:underline hover:text-foreground transition-colors",children:null==p?void 0:p.categoryName}),(0,a.jsx)("span",{className:"mx-1",children:"\xb7"}),(0,a.jsx)("span",{children:(r=null==p||null==(t=p.createdAt)?void 0:t.toDate(),c()(r).fromNow())})]})]})]}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsxs)(P.rI,{children:[(0,a.jsx)(P.ty,{asChild:!0,children:(0,a.jsx)(R.$,{variant:"ghost",size:"icon",className:"h-6 w-6 rounded-full",children:(0,a.jsx)("span",{className:"text-muted-foreground",children:"⋮"})})}),(0,a.jsxs)(P.SQ,{align:"end",className:"w-32",children:[(null==E?void 0:E.uid)===(null==p?void 0:p.authorId)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(P._2,{onClick:()=>{m.push("/add-post?isEditing=true&postId=".concat(null==p?void 0:p.id,"&title=").concat(encodeURIComponent((null==p?void 0:p.title)||""),"&content=").concat(encodeURIComponent((null==p?void 0:p.content)||""),"&categoryId=").concat((null==p?void 0:p.categoryId)||""))},children:"수정하기"}),(0,a.jsx)(P._2,{variant:"destructive",onClick:()=>{window.confirm("정말로 이 게시글을 삭제하시겠습니까?\n관련된 모든 댓글도 함께 삭제됩니다.")&&el()},children:"삭제하기"})]}),(0,a.jsx)(P._2,{onClick:()=>{alert("신고가 접수되었습니다."),J(!1)},children:"신고하기"})]})]})})]})}),(0,a.jsxs)(U.Wu,{className:"p-0 pt-2",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-[20px] font-semibold text-foreground mb-2",children:null==p?void 0:p.title}),(0,a.jsx)("p",{className:"text-[16px] text-foreground/90 leading-relaxed whitespace-pre-wrap",children:S(null==p?void 0:p.content).map(e=>"url"===e.type?(0,a.jsx)("a",{href:e.content,target:"_blank",rel:"noopener noreferrer",className:"text-muted-foreground hover:text-foreground hover:underline break-all",children:e.content},e.key):(0,a.jsx)("span",{children:e.content},e.key))})]}),S(null==p?void 0:p.content).some(e=>"url"===e.type)&&(0,a.jsx)("div",{className:"mt-4 text-sm text-muted-foreground space-y-1",children:S(null==p?void 0:p.content).map(e=>{if("url"===e.type){let t=e.content;try{t=new URL(e.content).hostname}catch(e){console.error("URL 파싱 실패:",e)}return(0,a.jsxs)("a",{href:e.content,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 text-muted-foreground hover:text-foreground hover:underline w-full",children:[(0,a.jsx)("span",{className:"flex-shrink-0",children:"\uD83D\uDD17"}),(0,a.jsx)("span",{className:"truncate flex-1",children:t})]},e.key)}return null})}),(0,a.jsx)("div",{className:"pt-12",children:(0,a.jsxs)("div",{className:"flex items-center justify-between text-[14px] text-muted-foreground",children:[(0,a.jsx)("div",{className:"flex items-center",children:X.length>0?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"flex -space-x-1 mr-1",children:X.map((e,t)=>(0,a.jsx)("div",{className:"w-5 h-5 flex items-center justify-center bg-background rounded-full text-sm border border-border shadow-sm",style:{zIndex:3-t,marginLeft:t>0?"-8px":"0"},children:e},t))}),(0,a.jsxs)("span",{children:[p.reactionCount||0,"명의 반응"]})]}):(0,a.jsxs)("span",{children:[p.reactionCount||0,"명의 반응"]})}),(0,a.jsxs)("span",{children:["댓글 ",p.commentCount||0]})]})})]}),(0,a.jsxs)(U.wL,{className:"flex items-center justify-between pt-3",children:[(0,a.jsxs)("div",{className:"relative flex-1 max-w-[33%]",children:[(0,a.jsxs)(R.$,{onClick:en,variant:"ghost",size:"sm",className:"ml-4 flex items-center gap-1.5 text-muted-foreground hover:text-foreground",children:[Q?(0,a.jsx)("span",{className:"text-base",children:Q.emoji}):(0,a.jsx)(b.px,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm ".concat(Q?"text-[#FF2600]":""),children:Q?Q.label:"반응"})]}),T&&(0,a.jsx)("div",{ref:K,className:"absolute bottom-full left-0 mb-2 bg-popover rounded-md shadow-md p-2 z-50 flex space-x-2 border border-border",children:L.Br.map(e=>(0,a.jsx)("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),ed(e)},className:"text-xl p-2 hover:bg-accent rounded-full transition-transform ".concat((null==Q?void 0:Q.id)===e.id?"scale-125 bg-accent/50":""),title:e.label,children:e.emoji},e.id))})]}),(0,a.jsx)("div",{className:"flex-1 max-w-[33%] flex justify-center",children:(0,a.jsxs)(R.$,{onClick:()=>{if(!A)return void alert("로그인이 필요합니다.");let e=document.querySelector("textarea");e&&e.focus()},variant:"ghost",size:"sm",className:"flex items-center gap-1.5 text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(b.b1,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"댓글"})]})}),(0,a.jsx)("div",{className:"flex-1 max-w-[33%] flex justify-end",children:(0,a.jsxs)(R.$,{onClick:e=>{e.preventDefault(),e.stopPropagation(),er()},variant:"ghost",size:"sm",className:"mr-4 flex items-center gap-1.5 text-muted-foreground hover:text-foreground",children:[(0,a.jsx)(b.li,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"공유"})]})})]})]})})}),(0,a.jsx)("div",{className:"w-full px-4 mt-4",children:(0,a.jsxs)("div",{className:"max-w-[590px] mx-auto",children:[(0,a.jsx)(U.Zp,{className:"bg-card shadow-sm mb-4 p-5",children:(0,a.jsx)(U.Wu,{className:"p-0",children:(0,a.jsx)("form",{onSubmit:et,children:(0,a.jsx)("div",{className:"w-full",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(D.eu,{className:"h-[30px] w-[30px]",children:A?(0,a.jsx)(D.BK,{src:(null==E?void 0:E.photoURL)||"https://api.dicebear.com/9.x/notionists-neutral/svg?seed=".concat(null==E?void 0:E.uid,"&backgroundColor=e8f5e9"),alt:"프로필"}):(0,a.jsx)(D.q5,{className:"bg-muted text-muted-foreground",children:"?"})})}),(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("div",{className:"flex items-center space-x-2 w-full",children:A?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("textarea",{value:C,onChange:e=>I(e.target.value),placeholder:"댓글을 달아주세요.",rows:1,className:"flex-1 bg-transparent resize-none border-none focus:outline-none focus:ring-0 text-[15px] text-foreground placeholder-muted-foreground overflow-hidden",style:{minHeight:"24px",height:C?"auto":"24px"},onInput:e=>{let t=e.currentTarget;t.style.height="24px",t.style.height=Math.max(24,t.scrollHeight)+"px"}}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(R.$,{type:"submit",size:"sm",children:h.includes("edit")?"수정":"올리기"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d(),{href:"/login",as:"/login?from=/posts/".concat(i),className:"flex-1",children:(0,a.jsx)("div",{className:"text-[15px] text-muted-foreground",children:"댓글을 작성하려면 로그인이 필요합니다."})}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(d(),{href:"/login",as:"/login?from=/posts/".concat(i),children:(0,a.jsx)(R.$,{size:"sm",children:"로그인"})})})]})})})]})})})})}),v.length>0&&(0,a.jsx)(U.Zp,{className:"bg-card shadow-sm",children:v.map((e,t)=>(0,a.jsxs)("div",{children:[(0,a.jsx)(N,{comment:{...e,authorPhotoURL:e.authorPhotoURL,userId:e.authorId},postAuthorId:p.authorId,onEdit:t=>ea(e.id,t),onDelete:()=>es(e.id)}),t!==v.length-1&&(0,a.jsx)("div",{className:"h-[1px] bg-border"})]},e.id))})]})}),Z&&(0,a.jsx)("div",{className:"fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-background text-foreground border border-border px-4 py-2 rounded-lg shadow-md",children:"링크가 복사되었습니다!"})]}):(console.log("포스트 데이터 없음"),(0,a.jsx)("div",{className:"text-center py-8 text-gray-700 dark:text-neutral-300",children:"포스트를 찾을 수 없습니다."}))}},8034:(e,t,r)=>{Promise.resolve().then(r.bind(r,5273))}},e=>{var t=t=>e(e.s=t);e.O(0,[992,146,855,874,389,498,308,84,175,441,684,358],()=>t(8034)),_N_E=e.O()}]);